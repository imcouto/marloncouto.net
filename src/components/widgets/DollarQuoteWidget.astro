---
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { GET as getDollarQuote } from '@/pages/api/dollar-quote.ts';
import type { DollarQuoteData } from '@/types/index.ts';
import { DollarSign, TrendingDown, TrendingUp } from 'lucide-react';

const res = await getDollarQuote(Astro);
const data = await res.json();
if (data?.error) {
  console.error('Failed to fetch dollar data:', data.error);
}

const dollarData: DollarQuoteData = data?.dollarQuote;
// console.log('dollarData :>> ', dollarData);

const formattedDate = new Date(dollarData.lastUpdate).toLocaleString('pt-BR', {
  day: '2-digit',
  month: '2-digit',
  year: 'numeric',
  hour: '2-digit',
  minute: '2-digit',
});
// console.log('formattedDate :>> ', formattedDate);
---

<Card className='w-full max-w-sm mx-auto'>
  <CardHeader>
    <CardTitle className='flex items-center justify-between'>
      <span>Cotação do Dólar</span>
      <DollarSign className='w-6 h-6' />
    </CardTitle>
  </CardHeader>
  <CardContent>
    <div class='flex items-center justify-between mb-4'>
      <div class='text-4xl font-bold'>
        R$ {dollarData.quote.toFixed(2)}
      </div>
      <div
        class={`flex items-center ${
          dollarData.variation >= 0 ? 'text-green-500' : 'text-red-500'
        }`}
      >
        {
          dollarData.variation >= 0 ? (
            <TrendingUp className='w-5 h-5 mr-1' />
          ) : (
            <TrendingDown className='w-5 h-5 mr-1' />
          )
        }
        <span>{Math.abs(dollarData.variation).toFixed(2)}%</span>
      </div>
    </div>
    <div class='text-sm text-muted-foreground'>
      Última atualização: {formattedDate}
    </div>
  </CardContent>
</Card>
